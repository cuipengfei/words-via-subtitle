## "字幕学单词"现代化重写计划 (基于 Electron + Next.js + TypeScript)

### 1. 项目目标

- **跨平台支持**：确保应用能够在 Windows、macOS 和 Linux 主流桌面操作系统上原生运行。
- **现代化 UI/UX**：提供符合现代审美和用户习惯的界面设计与交互体验，利用现代 Web 前端框架的能力。
- **技术栈更新**：采用现代、高效、易于维护的 Web 技术栈 (Electron, Next.js, TypeScript, Tailwind CSS)。
- **核心功能选择性迁移**：有选择性地迁移 `file_analysis.md` 中描述的核心功能，摒弃幻灯片演示模式等过时功能，并根据现代需求进行优化。
- **简化架构**：设计精简的架构，专注于核心功能，不再使用插件机制，构建一个功能固定但高效可靠的独立应用。
- **性能提升**：利用 TypeScript 的类型安全和现代 JavaScript 生态中的高效库，优化字幕解析、词汇处理和视频同步性能。

### 2. 技术选型建议 (基于 Electron + Next.js + TypeScript)

- **核心框架**: **Electron**。负责创建应用窗口、管理原生功能（如文件访问、菜单、通知等）以及主进程与渲染进程的通信。
- **主进程 (Main Process)**: Node.js 环境。处理应用生命周期、原生 API 调用、文件 I/O、数据库交互等不适合在渲染进程中直接进行的操作。
- **渲染进程 (Renderer Process)**: Next.js 环境基于 Web 页面 (HTML, CSS, TypeScript)。负责构建和渲染用户界面。
- **前端技术栈**:
  - **Next.js**: 基于 React 的框架，提供服务器端渲染、路由、API 路由等功能。
  - **TypeScript**: 强类型的 JavaScript 超集，提供更好的开发体验和代码质量。
  - **Tailwind CSS**: 实用优先的 CSS 框架，用于快速构建自定义界面设计。
  - **React**: 组件化思想，生态庞大，适合大型应用。
- **字幕解析**:
  - 寻找现有的 TypeScript 字幕解析库（SRT, ASS）。例如 `subtitles-parser` 或类似的库。
  - 如果现有库不满足需求，根据原 C# 逻辑（正则表达式等）在 TypeScript 中重写解析逻辑。这部分逻辑可以在主进程或 Web Worker 中执行，避免阻塞 UI。
- **词典系统**:
  - **在线词典**: 使用 Node.js 的 `fetch` 或 `axios` 等库调用在线翻译/词典 API（如有道、谷歌、必应等翻译 API）。注意处理跨域问题（在主进程中调用 API）。
  - **用户数据存储**: 仅针对用户学习记录、已知单词列表和个人设置使用本地存储，不存储词典数据。
- **视频播放**:
  - 使用 HTML5 的 `<video>` 标签。这是最简单的方式，支持浏览器原生支持的格式。
  - 对于更多格式或高级控制，可以考虑集成 `electron-vlc-player` 或类似的库，它利用 VLC 播放器。
- **语音合成 (TTS)**:
  - 尝试使用 Web Speech API 在渲染进程中实现。
  - 如果需要更稳定的跨平台支持或更多语音选项，可以使用 Node.js 库（如 `say`）调用操作系统原生的 TTS 功能，通过 IPC 与渲染进程通信。
- **数据存储**:
  - 用户数据: JSON 文件或简单的本地数据库存储用户已知单词列表和学习记录。
  - 配置: JSON 文件存储应用配置信息。
- **构建与打包**: **electron-builder**。
- **版本控制**: Git。
- **CI/CD**: GitHub Actions，使用 TypeScript 脚本进行自动化构建和打包。

### 3. 重写阶段与任务 (基于 Electron + Next.js + TypeScript)

#### 阶段一：项目启动、架构设计与基础环境搭建 (预计 2-3 周)

1.  **详细需求分析与确认**：
    - 基于 `file_analysis.md`，梳理并选择性保留核心功能点。
    - 确定功能优先级和迭代计划。
    - 排除幻灯片演示模式功能，专注于核心学习体验。
2.  **技术栈与环境搭建**：
    - 搭建 Electron + Next.js + TypeScript + Tailwind CSS 项目结构。
    - 建立 Git 仓库、GitHub Actions CI/CD 配置。
    - 设置主进程与渲染进程的基本通信 (IPC)。
3.  **新应用架构设计**：
    - 设计主进程和渲染进程的职责划分。
    - 设计模块化架构（UI 组件、业务逻辑服务、数据访问模块）。
    - 定义清晰的 IPC 通信协议。
4.  **基础模块调研与选型**：
    - 调研并选择合适的字幕解析库、本地数据存储方案、HTTP 请求库等。
    - 评估可用的在线词典 API，确定主要和备选词典服务。

#### 阶段二：基础界面与核心功能框架实现 (预计 4-5 周)

1.  **现代化 UI/UX 设计**：
    - 设计全新的应用界面和交互流程，使用 Tailwind CSS 和 React 组件。
    - 实现响应式基础布局（侧边栏、内容区、播放控制区）。
2.  **实现基础 Electron 窗口与菜单**：
    - 创建主窗口，配置窗口属性。
    - 实现基本的应用菜单（文件、编辑、帮助等）。
3.  **字幕文件加载与初步解析**：
    - 在主进程中实现文件选择对话框。
    - 将文件路径发送到主进程，使用选定的字幕解析库进行解析。
    - 将解析出的原始数据（包含时间戳）通过 IPC 发送回渲染进程。
4.  **实现单词列表展示**：
    - 在渲染进程中使用 React 组件渲染解析出的单词列表。
    - 实现列表的滚动、筛选和选择功能。

#### 阶段三：核心功能实现与集成 (预计 6-8 周)

1.  **词汇处理与过滤**：
    - 在主进程或 Web Worker 中实现单词提取、清洗（去除标点）。
    - 实现已知单词过滤逻辑（从本地存储加载用户已知单词列表）。
    - 将过滤后的单词列表发送到渲染进程。
2.  **在线词典集成与用户数据管理**：
    - 在主进程中实现在线词典 API 调用服务。
    - 实现多个在线词典服务的集成，确保查询服务的可靠性。
    - 实现已知单词的添加、删除、查询功能，使用 JSON 文件或简单本地数据库存储。
    - 设计用户学习记录和进度跟踪功能。
3.  **词典查询界面实现**：
    - 在渲染进程中实现词典查询结果展示 UI。
    - 实现多词典来源的切换功能。
    - 通过 IPC 调用主进程的词典查询服务。
    - 设计良好的错误处理和离线状态提示。
4.  **视频播放器集成与同步**：
    - 在渲染进程中嵌入 HTML5 `<video>` 标签或集成 `electron-vlc-player`。
    - 实现视频加载、播放、暂停、跳转控制。
    - 实现根据选中单词的时间戳控制视频跳转播放。
5.  **语音合成 (TTS) 功能**：
    - 集成 Web Speech API 或 Node.js TTS 库。
    - 实现单词发音按钮和调用逻辑。

#### 阶段四：高级功能、优化与测试 (预计 4-6 周)

1.  **增强学习功能**：
    - 实现单词复习功能，根据学习记录生成复习列表。
    - 设计简单的单词记忆测试功能。
    - 实现学习进度统计和可视化。
2.  **应用内数据存储优化**：
    - 优化本地数据存储结构，确保学习记录和用户偏好保存可靠。
    - 实现数据备份和恢复功能。
3.  **性能优化**：
    - 优化大字幕文件解析性能（使用 Web Worker 或主进程）。
    - 优化大量单词列表的渲染性能（使用虚拟列表等前端技术）。
    - 优化 IPC 通信效率和在线词典查询缓存策略。
4.  **全面测试**：
    - 单元测试、集成测试。
    - 在目标平台 (Windows, macOS, Linux) 上进行兼容性测试和用户体验测试。
    - Bug 修复。

#### 阶段五：打包、发布与文档 (预计 2-3 周)

1.  **应用打包**：
    - 使用 `electron-builder` 为各平台生成可执行文件和安装包。
    - 配置应用图标、名称等元信息。
2.  **发布准备**：
    - 准备应用商店上架材料（如果计划上架）或网站下载页面。
3.  **文档编写**：
    - 用户手册。
    - 开发者文档。
4.  **开源与社区 (如果计划开源)**：
    - 整理代码，发布到 GitHub 等平台。
    - 建立社区支持渠道。

### 4. 关键考虑因素 (Electron + Next.js + TypeScript 方案)

- **主进程与渲染进程通信 (IPC)**：这是 Electron 开发的核心。需要设计清晰的通信协议，避免在渲染进程中执行耗时或需要原生权限的操作。
- **TypeScript 类型安全**：充分利用 TypeScript 的类型系统确保代码质量，特别是在 IPC 通信和数据处理环节。
- **在线 API 依赖**：依赖在线词典服务需要考虑网络异常、API 限流和变更等情况，需要设计良好的错误处理和备选方案。
- **应用性能**：Electron 应用通常比原生应用占用更多资源。需要注意优化前端渲染性能、避免内存泄漏、合理使用主进程和渲染进程。
- **安全性**：特别是在加载外部内容或处理用户输入时，需要注意安全风险，例如禁用 Node.js 集成在渲染进程中，使用 Context Isolation 等。
- **打包体积**：Electron 应用通常体积较大，可以通过代码优化、资源压缩、按需加载等方式尽量减小体积。

### 5. 风险与缓解

- **Web 技术栈学习曲线**：如果团队缺乏现代 Web 前端和 Node.js 开发经验。
  - 缓解：团队成员进行相关技术培训，从小模块开始实践。
- **Electron 特有问题**：主进程/渲染进程通信、原生 API 调用、打包等可能遇到特有问题。
  - 缓解：查阅 Electron 官方文档和社区资源，学习最佳实践。
- **性能问题**：处理大文件或复杂 UI 时可能出现性能瓶颈。
  - 缓解：早期进行性能测试，使用性能分析工具定位问题，优化算法和渲染方式，使用 Web Worker 或主进程处理耗时任务。
- **在线 API 不稳定性**：依赖外部词典 API 可能导致功能受限或失效。
  - 缓解：设计多个词典 API 备选源，实现优雅的失败处理和自动切换机制，增加错误处理和用户提示。

这个计划为您提供了使用 Electron + Next.js + TypeScript 重写"字幕学单词"应用的路线图，专注于核心功能，移除了插件系统和本地词典，使应用更加精简和现代化。
